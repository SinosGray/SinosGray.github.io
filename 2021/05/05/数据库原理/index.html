
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>数据库原理 - Sinos_wei&#39;s blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="
数据库原理课程



1 绪论模型组成要素: 数据结构, 数据操作, 完整性约束
概念模型er 模型实体: 学生
属性: 学号 姓名
实体型: 学生(学号, 姓名)
码: 学号
E-R图 enti,"> 
    <meta name="author" content="Sinos_wei"> 
    <link rel="alternative" href="atom.xml" title="Sinos_wei&#39;s blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/a33.jpg"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Sinos_wei&#39;s blog</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://sinos_wei.gitee.io"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">数据库原理</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">数据库原理</h1>
        <div class="stuff">
            <span>五月 05, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/database/" rel="tag">database</a></li></ul>


        </div>
        <div class="content markdown">
            <blockquote>
<p>数据库原理课程</p>
</blockquote>
<span id="more"></span>

<h1 id="1-绪论"><a href="#1-绪论" class="headerlink" title="1 绪论"></a>1 绪论</h1><h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>组成要素: 数据结构, 数据操作, 完整性约束</p>
<h3 id="概念模型"><a href="#概念模型" class="headerlink" title="概念模型"></a>概念模型</h3><h4 id="er-模型"><a href="#er-模型" class="headerlink" title="er 模型"></a>er 模型</h4><p>实体: 学生</p>
<p>属性: 学号 姓名</p>
<p>实体型: 学生(学号, 姓名)</p>
<p>码: 学号</p>
<h4 id="E-R图-entity-relationship-model"><a href="#E-R图-entity-relationship-model" class="headerlink" title="E-R图 entity relationship model"></a>E-R图 entity relationship model</h4><p>矩形: 实体型</p>
<p>菱形: 联系</p>
<p>椭圆形: 实体型与联系类型的属性</p>
<p>直线: 实体与属性间, 实体型与联系之间用直线相连, 线旁标注联系的种类(1:1, 1:N, M:N)</p>
<p>码: 属性加下划线</p>
<h3 id="逻辑模型"><a href="#逻辑模型" class="headerlink" title="逻辑模型"></a>逻辑模型</h3><p>层次模型, 树 冗余节点, 虚拟节点</p>
<p>网状模型</p>
<p>关系模型, 表 </p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs61d4undoj30t60lmn94.jpg" alt="截屏2021-07-05 下午2.02.26"></p>
<p>面向对象模型</p>
<h2 id="三级模式"><a href="#三级模式" class="headerlink" title="三级模式"></a>三级模式</h2><p>模式=型<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs61jw7qtxj30t60fogrg.jpg" alt="截屏2021-07-05 下午2.08.59"></p>
<p>外模式(子模式, 用户模式), 数据库用户使用的局部数据结构, 应用程序可以直接访问, 一个应用程序只有一个外模式</p>
<p>内模式(存储模式, 物理模式)</p>
<h1 id="2-关系数据库"><a href="#2-关系数据库" class="headerlink" title="2 关系数据库"></a>2 关系数据库</h1><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p>笛卡尔积</p>
<p>候选码, 主码, 外码</p>
<h3 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">设有如下四个关系：</span><br><span class="line">T(TNO,TNAME,TITLE)——描述某院系的各个教师的工作证号、姓名和职称；</span><br><span class="line">S(SNO,SNAME,SYEAR,TNO)——描述该院系的各个学生的学号、姓名、入学年份和学业导师的工作证号；</span><br><span class="line">P(PNO,PNAME,PYEAR)——描述该院系的各个科研项目的项目编号、项目名称和立项年份；</span><br><span class="line">TP(TNO,PNO)——描述教师参与科研项目的情况；</span><br><span class="line">SPT(SNO,PNO,TNO)——描述学生参与各个项目并在每个项目中的指导教师。</span><br><span class="line">请写出下列关系代数表达式</span><br></pre></td></tr></table></figure>

<h4 id="σ选择"><a href="#σ选择" class="headerlink" title="σ选择"></a>σ选择</h4><p>对关系R, σ<del>A&lt;5</del>(R) 代表A&lt;5的R 的子集, σ<del>A&lt;5^C=7</del>(R)</p>
<h4 id="π投影"><a href="#π投影" class="headerlink" title="π投影"></a>π投影</h4><p>从 R 中选出若干元素组成新关系π<del>B,C</del>(R)</p>
<h4 id="θ连接"><a href="#θ连接" class="headerlink" title="θ连接"></a>θ连接</h4><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqdx6r2ihbj30ji044gmv.jpg" alt="截屏2021-05-11 上午3.01.48" style="zoom:25%;" />

<p>等值连接-&gt;自然连接, 全左右外连接</p>
<h4 id="÷除法"><a href="#÷除法" class="headerlink" title="÷除法"></a>÷除法</h4><p>R(X, Y)÷S(Y, Z), 得到R 中 Y 与 S 中 Y 相等的R 中除Y 以外的投影</p>
<h2 id="完整性"><a href="#完整性" class="headerlink" title="完整性"></a>完整性</h2><h3 id="实体完整性"><a href="#实体完整性" class="headerlink" title="实体完整性"></a>实体完整性</h3><p>主属性不能取空值</p>
<h3 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h3><p>假设, R中的F是S的主码, 则F是R的外码, R参照关系, S目标关系</p>
<p>参照完整性: R中每个元组在F上的值或者为空, 或者为S中某个元组的主码值</p>
<h3 id="用户定义的完整性"><a href="#用户定义的完整性" class="headerlink" title="用户定义的完整性"></a>用户定义的完整性</h3><p>语义要求</p>
<h1 id="3-sql"><a href="#3-sql" class="headerlink" title="3 sql"></a>3 sql</h1><h2 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h2><p>类似命名空间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> schema schema_name <span class="keyword">authorization</span> user_name</span><br><span class="line"><span class="keyword">drop</span> schema cascade <span class="comment">--cascade表级联</span></span><br></pre></td></tr></table></figure>

<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">    id <span class="type">int</span>(<span class="keyword">constraint</span> PK_person <span class="keyword">primary</span> key),</span><br><span class="line">  	cno <span class="type">char</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>(<span class="keyword">references</span> course(cno)),</span><br><span class="line">    fullname <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    telephone <span class="type">char</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">CONSTRAINT</span> PK_person <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">  	<span class="keyword">constraint</span> fk_person_cno <span class="keyword">foreign</span> key(cno) <span class="keyword">references</span> cource(cno)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>primary key 不可为空 </p>
<p>unique 可有一个空 </p>
<p>not null</p>
<p>foreign key</p>
<p>check(逻辑表达式)</p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span>] index index_name <span class="keyword">on</span> table_name(column_name)</span><br></pre></td></tr></table></figure>

<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> phone <span class="type">char</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> course <span class="keyword">alter</span> <span class="keyword">column</span> credit <span class="type">smallint</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> course <span class="keyword">add</span> <span class="keyword">constraint</span> fk_cpno <span class="keyword">foreign</span> key(cpno) <span class="keyword">references</span> course(cno)</span><br></pre></td></tr></table></figure>

<h2 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h2><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a1, a2 </span><br><span class="line">[<span class="keyword">from</span> <span class="keyword">table</span>] </span><br><span class="line">[<span class="keyword">where</span> exp] </span><br><span class="line">[<span class="keyword">group</span> <span class="keyword">by</span> exp] </span><br><span class="line">[<span class="keyword">having</span> exp]</span><br><span class="line">[<span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">asc</span> <span class="operator">|</span> <span class="keyword">desc</span>]</span><br></pre></td></tr></table></figure>



<h1 id="6-关系数据理论"><a href="#6-关系数据理论" class="headerlink" title="6 关系数据理论"></a>6 关系数据理论</h1><h2 id="函数依赖"><a href="#函数依赖" class="headerlink" title="函数依赖"></a>函数依赖</h2><p>任意性, 语义性, 与时间无关, </p>
<p>类似 f(x) = y</p>
<p>平凡(子集)非平凡(不是子集)</p>
<p>完全函数依赖, 部分函数依赖(只依赖一部分)</p>
<h2 id="函数依赖的公理系统"><a href="#函数依赖的公理系统" class="headerlink" title="函数依赖的公理系统"></a>函数依赖的公理系统</h2><p>依赖集 F</p>
<p>最小依赖集 F<del>m</del> </p>
<p>求候选码</p>
<p>求右边没有出现的 N, 求两边都出现的 LR</p>
<p>候选码 = N + LR 的一部分</p>
<h2 id="范式"><a href="#范式" class="headerlink" title="范式"></a>范式</h2><h3 id="1NF"><a href="#1NF" class="headerlink" title="1NF"></a>1NF</h3><p>R(U, F) U 中每个属性和值均为不可再分的原子项</p>
<h3 id="2NF"><a href="#2NF" class="headerlink" title="2NF"></a>2NF</h3><p>每一个<strong>非主属性</strong>都完全函数依赖于 R 的码</p>
<h3 id="3NF"><a href="#3NF" class="headerlink" title="3NF"></a>3NF</h3><p>不存在<strong>非主属性</strong>对码的传递函数依赖</p>
<p>或: 关系模式 R 的所有非平凡函数依赖, 要么左侧包含候选码, 要么右侧是主属性</p>
<p>即不允许 x→y→z, x: 码, y: 不含码, z: 非主属性, 且 z∉y</p>
<h3 id="BCNF"><a href="#BCNF" class="headerlink" title="BCNF"></a>BCNF</h3><p>非平凡函数依赖左侧必包含候选码</p>
<p>要么左侧包含候选码, 要么右侧是主属性</p>
<p>二元关系必为 bcnf</p>
<h3 id="4NF"><a href="#4NF" class="headerlink" title="4NF"></a>4NF</h3><p>没有非平凡的非函数依赖的多值依赖</p>
<h2 id="模式分解"><a href="#模式分解" class="headerlink" title="模式分解"></a>模式分解</h2><p>分解为两个的特殊算法: 交决定差</p>
<h1 id="9-关系查询和查询优化"><a href="#9-关系查询和查询优化" class="headerlink" title="9 关系查询和查询优化"></a>9 关系查询和查询优化</h1><h2 id="查询操作算法"><a href="#查询操作算法" class="headerlink" title="查询操作算法"></a>查询操作算法</h2><h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><p>全表</p>
<p>索引</p>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>嵌套循环</p>
<p>排序合并</p>
<p>索引连接</p>
<p>哈希</p>
<h1 id="10-数据库恢复"><a href="#10-数据库恢复" class="headerlink" title="10 数据库恢复"></a>10 数据库恢复</h1><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>原子性, 一致性, 隔离性, 持续性</p>
<h2 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h2><p>转储 备份+日志</p>
<p>日志文件 undo 没结束的, redo 结束的</p>
<p>检查点</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6kgfbzccj30ou0fuad1.jpg" alt="截屏2021-07-06 上午1.03.03"></p>
<p>activelist-&gt;t2 t3</p>
<h1 id="11-并发控制"><a href="#11-并发控制" class="headerlink" title="11 并发控制"></a>11 并发控制</h1><p>丢失更新</p>
<p>读脏</p>
<p>不可重复读</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><p>x 写锁 s 读锁<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6kregxo7j30qu0dyn0p.jpg" alt="截屏2021-07-06 上午1.13.36"></p>
<h3 id="1-级封锁协议"><a href="#1-级封锁协议" class="headerlink" title="1 级封锁协议"></a>1 级封锁协议</h3><p>修改前必须加 x 锁</p>
<p>可能读脏, 可能不可重复读</p>
<h3 id="2-级封锁协议"><a href="#2-级封锁协议" class="headerlink" title="2 级封锁协议"></a>2 级封锁协议</h3><p>1 级+读前加 s</p>
<p>可能不可重复读</p>
<h3 id="3-级封锁协议"><a href="#3-级封锁协议" class="headerlink" title="3 级封锁协议"></a>3 级封锁协议</h3><p>一直持有锁</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6kvv5b9wj30t00j2qf8.jpg" alt="截屏2021-07-06 上午1.17.52"></p>
<p>不同事务同一数据, 读读可交换</p>
<p>不同事务不同数据, 读写都可交换</p>
<p>2pl</p>
<p>读写前申请封锁, 释放后不再获得其他封锁</p>
<p>is ix six 锁</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gs6veub40nj30s40lkn7k.jpg" alt="截屏2021-07-06 上午7.22.04"></p>
<h1 id="sql-必知必会"><a href="#sql-必知必会" class="headerlink" title="sql 必知必会"></a>sql 必知必会</h1><h2 id="primary-key"><a href="#primary-key" class="headerlink" title="primary key"></a>primary key</h2><ul>
<li>主键列不允许为 null</li>
<li>主键值不允许修改或更新</li>
<li>主键值不能重用(如果某行被删除, 则它的主键不能赋给之后的新行)</li>
</ul>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><p>ASC 升序(0-9, A-Z), DESC 降序</p>
<p>排序子句必须是 select 语句的最后一句</p>
<h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>BETWEEN 1 AND 9</p>
<p>运算符优先级先 AND 再 OR</p>
<p>IN(‘1’, ‘2’) 枚举</p>
<h3 id="LIKE与通配符"><a href="#LIKE与通配符" class="headerlink" title="LIKE与通配符"></a>LIKE与通配符</h3><p><code>LIKE &#39;FISH%&#39;</code></p>
<p>%(*) 表示任何字符出现任意次数(0~n)</p>
<p>_(?)表示 1 个任意字符</p>
<p>[]表示一个字符集, 匹配一个字符, 可以加^表 NOT <code>[^JM]%</code>表示不以 J 或 M 开头的字符串</p>
<h2 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h2><p>+-*/</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>文本处理函数如 trim()</p>
<p>日期处理函数如 datepart()</p>
<p>数值处理函数如 abs()</p>
<h3 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h3><p>运行在<strong>行组</strong>上, 计算和返回单个值的函数</p>
<p>AVG(), COUNT(), MAX(), MIN(), SUM()</p>
<p>只有 COUNT(*)不忽略 null, 其他都忽略 null</p>
<p>DISTINCT 关键字表示只包含不同的值(不重复计算)</p>
<h2 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h2><p>将<strong>行</strong>分组</p>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>类似于 where, 区别在于 where 过滤行, having 过滤分组</p>
<h2 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h2><h3 id="INNER-JOIN-ON"><a href="#INNER-JOIN-ON" class="headerlink" title="INNER JOIN ON"></a>INNER JOIN ON</h3><h3 id="OUTER-JOIN-ON"><a href="#OUTER-JOIN-ON" class="headerlink" title="OUTER JOIN ON"></a>OUTER JOIN ON</h3><h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    fullname <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    telephone <span class="type">char</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_person <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表2 地点表(location)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> location(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    location_name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_location <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表3 行程表（itinerary）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> itinerary(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>, <span class="comment">--人员编号</span></span><br><span class="line">    loc_id <span class="type">int</span>, <span class="comment">--地点编号</span></span><br><span class="line">    s_time DATETIME,</span><br><span class="line">    e_time DATETIME,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_itinerary <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_lid <span class="keyword">FOREIGN</span> KEY (loc_id) <span class="keyword">REFERENCES</span> location(id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表4 诊断表（diagnose_record）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> diagnose_record(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    diagnose_date DATETIME,</span><br><span class="line">    <span class="keyword">result</span> <span class="type">int</span>, <span class="comment">--1：新冠确诊;2：无症状感染者;3：正常</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_diagnose_record <span class="keyword">PRIMARY</span> KEY(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_diagnose_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表5 密切接触者表（close_contact）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> close_contact(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    loc_id <span class="type">int</span>,</span><br><span class="line">    contact_date DATETIME,</span><br><span class="line">    case_p_id <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_close_contact <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_lid <span class="keyword">FOREIGN</span> KEY (loc_id) <span class="keyword">REFERENCES</span> location(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_caseid <span class="keyword">FOREIGN</span> KEY (case_p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表6 隔离地点表（isolation_location）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> isolation_location(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    location_name <span class="type">char</span>(<span class="number">20</span>),</span><br><span class="line">    capacity <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_isolation_loc <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 表7 隔离表（isolation_record）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> isolation_record(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    isol_loc_id <span class="type">int</span>,</span><br><span class="line">    s_date DATETIME,</span><br><span class="line">    e_date DATETIME,</span><br><span class="line">    state <span class="type">int</span>,<span class="comment">--1：正在隔离 2：隔离结束 3：转入医院</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_isolation <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_isolation_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_isolation_lid <span class="keyword">FOREIGN</span> KEY (isol_loc_id) <span class="keyword">REFERENCES</span> isolation_location(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>创建用户, 修改权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> login user0 <span class="keyword">with</span> password<span class="operator">=</span><span class="string">&#x27;123qwe123&#x27;</span>, default_database<span class="operator">=</span>student</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> user0 <span class="keyword">for</span> login user0 <span class="keyword">with</span> default_schema<span class="operator">=</span>dbo</span><br><span class="line"><span class="keyword">exec</span> sp_addrolemember <span class="string">&#x27;db_owner&#x27;</span>, <span class="string">&#x27;dba&#x27;</span></span><br></pre></td></tr></table></figure>



<p>lab</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> combo(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>, <span class="comment">--人员编号</span></span><br><span class="line">    loc_id <span class="type">int</span>, <span class="comment">--地点编号</span></span><br><span class="line">    s_time DATETIME,</span><br><span class="line">    e_time DATETIME,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_itinerary <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_lid <span class="keyword">FOREIGN</span> KEY (loc_id) <span class="keyword">REFERENCES</span> location(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE covid19mon;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> DATABASE covid19mon;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE covid19mon;</span><br><span class="line">USE covid19mon;</span><br><span class="line">go</span><br><span class="line"><span class="comment">-- 请在以下适当的空白位置填写SQL语句完成任务书的要求。空白位置不够的话，可以通过回车换行增加。</span></span><br><span class="line"><span class="comment">-- 表1 人员表(person)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    fullname <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    telephone <span class="type">char</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_person <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表2 地点表(location)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> location(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    location_name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_location <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表3 行程表（itinerary）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> itinerary(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>, <span class="comment">--人员编号</span></span><br><span class="line">    loc_id <span class="type">int</span>, <span class="comment">--地点编号</span></span><br><span class="line">    s_time DATETIME,</span><br><span class="line">    e_time DATETIME,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_itinerary <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_itinerary_lid <span class="keyword">FOREIGN</span> KEY (loc_id) <span class="keyword">REFERENCES</span> location(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表4 诊断表（diagnose_record）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> diagnose_record(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    diagnose_date DATETIME,</span><br><span class="line">    <span class="keyword">result</span> <span class="type">int</span>, <span class="comment">--1：新冠确诊;2：无症状感染者;3：正常</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_diagnose_record <span class="keyword">PRIMARY</span> KEY(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_diagnose_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表5 密切接触者表（close_contact）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> close_contact(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    loc_id <span class="type">int</span>,</span><br><span class="line">    contact_date DATETIME,</span><br><span class="line">    case_p_id <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_close_contact <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_lid <span class="keyword">FOREIGN</span> KEY (loc_id) <span class="keyword">REFERENCES</span> location(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_contact_caseid <span class="keyword">FOREIGN</span> KEY (case_p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表6 隔离地点表（isolation_location）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> isolation_location(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    location_name <span class="type">char</span>(<span class="number">20</span>),</span><br><span class="line">    capacity <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_isolation_loc <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表7 隔离表（isolation_record）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> isolation_record(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    p_id <span class="type">int</span>,</span><br><span class="line">    isol_loc_id <span class="type">int</span>,</span><br><span class="line">    s_date DATETIME,</span><br><span class="line">    e_date DATETIME,</span><br><span class="line">    state <span class="type">int</span>,<span class="comment">--1：正在隔离 2：隔离结束 3：转入医院</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_isolation <span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_isolation_pid <span class="keyword">FOREIGN</span> KEY (p_id) <span class="keyword">REFERENCES</span> person(id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_isolation_lid <span class="keyword">FOREIGN</span> KEY (isol_loc_id) <span class="keyword">REFERENCES</span> isolation_location(id)</span><br><span class="line">);</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">1</span>,N<span class="string">&#x27;张小敏&#x27;</span>,N<span class="string">&#x27;13907110001&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">2</span>,N<span class="string">&#x27;李大锤&#x27;</span>,N<span class="string">&#x27;18907110002&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">3</span>,N<span class="string">&#x27;孙二娘&#x27;</span>,N<span class="string">&#x27;13307100003&#x27;</span>);</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> person <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">UPDATE table_name <span class="keyword">SET</span> telephone<span class="operator">=</span>N<span class="string">&#x27;13607176668&#x27;</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="comment">--1</span></span><br><span class="line"><span class="keyword">select</span> location_name, <span class="built_in">count</span>(itinerary.loc_id) <span class="keyword">as</span> visitors</span><br><span class="line"><span class="keyword">from</span> itinerary</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> location</span><br><span class="line"><span class="keyword">ON</span> itinerary.loc_id <span class="operator">=</span> location.id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> location.location_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">count</span>(itinerary.loc_id)<span class="operator">&gt;</span><span class="number">30</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> visitors <span class="keyword">DESC</span>, location_name <span class="keyword">ASC</span></span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="keyword">SELECT</span> isolation_location.location_name, <span class="built_in">COUNT</span>(isolation_record.isol_loc_id) <span class="keyword">as</span> number</span><br><span class="line"><span class="keyword">FROM</span> isolation_location</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> isolation_record</span><br><span class="line"><span class="keyword">ON</span> isolation_record.isol_loc_id <span class="operator">=</span> isolation_location.id </span><br><span class="line"><span class="keyword">WHERE</span> isolation_record.state <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> isolation_location.location_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> number <span class="keyword">DESC</span>, isolation_location.location_name <span class="keyword">ASC</span></span><br><span class="line"><span class="comment">--3</span></span><br><span class="line"><span class="keyword">SELECT</span> person.<span class="operator">*</span>, x.e_time <span class="keyword">as</span> reclosing_time, loc1.id <span class="keyword">as</span> loc1, loc1.location_name <span class="keyword">as</span> address1, loc2.id <span class="keyword">as</span> loc2, loc2.location_name <span class="keyword">as</span> address2</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">itinerary x</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> person <span class="keyword">ON</span> x.p_id <span class="operator">=</span> person.id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> location <span class="keyword">as</span> loc1 <span class="keyword">ON</span> x.loc_id <span class="operator">=</span> loc1.id</span><br><span class="line"></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line">(itinerary y</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> location <span class="keyword">as</span> loc2 <span class="keyword">ON</span> y.loc_id <span class="operator">=</span> loc2.id)</span><br><span class="line"><span class="keyword">ON</span> x.e_time <span class="operator">=</span> y.s_time <span class="keyword">AND</span> y.p_id <span class="operator">=</span> person.id</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> person.id<span class="operator">&gt;</span><span class="number">30</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> person.id, person.fullname, person.telephone, x.e_time, loc1.id, loc1.location_name, loc2.id, loc2.location_name</span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> person.id, reclosing_time</span><br><span class="line"></span><br><span class="line"><span class="comment">--4</span></span><br><span class="line"><span class="keyword">SELECT</span> person.fullname, person.telephone, location.location_name, <span class="keyword">convert</span>(<span class="type">char</span>(<span class="number">19</span>),itinerary.s_time,<span class="number">20</span>) <span class="keyword">as</span> s_time, <span class="keyword">convert</span>(<span class="type">char</span>(<span class="number">19</span>),itinerary.e_time,<span class="number">20</span>) <span class="keyword">as</span> e_time</span><br><span class="line"><span class="keyword">from</span> person</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">JOIN</span> itinerary <span class="keyword">ON</span> person.id <span class="operator">=</span> itinerary.p_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">JOIN</span> location <span class="keyword">ON</span> itinerary.loc_id <span class="operator">=</span> location.id</span><br><span class="line"><span class="keyword">WHERE</span> person.fullname <span class="keyword">in</span>(N<span class="string">&#x27;充珉瑶&#x27;</span>, N<span class="string">&#x27;贾涵山&#x27;</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> person.id <span class="keyword">DESC</span>, itinerary.s_time</span><br><span class="line"></span><br><span class="line"><span class="comment">--5</span></span><br><span class="line"><span class="keyword">SELECT</span> id, location_name</span><br><span class="line"><span class="keyword">from</span> location</span><br><span class="line"><span class="keyword">WHERE</span> location_name <span class="keyword">LIKE</span> N<span class="string">&#x27;%店%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">by</span> id</span><br><span class="line"></span><br><span class="line"><span class="comment">--6</span></span><br><span class="line"><span class="keyword">SELECT</span> person.fullname, person.telephone</span><br><span class="line"><span class="keyword">from</span> person</span><br><span class="line"><span class="keyword">where</span> person.id</span><br><span class="line"><span class="keyword">IN</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> itinerary.p_id </span><br><span class="line">    <span class="keyword">from</span> itinerary <span class="keyword">JOIN</span> location <span class="keyword">ON</span> itinerary.loc_id <span class="operator">=</span> location.id</span><br><span class="line">    <span class="keyword">where</span> location.location_name <span class="operator">=</span> N<span class="string">&#x27;活动中心&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> (</span><br><span class="line">        itinerary.e_time <span class="keyword">between</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 20:05:40&#x27;</span> <span class="keyword">as</span> datetime) <span class="keyword">and</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 21:25:40&#x27;</span> <span class="keyword">as</span> datetime)</span><br><span class="line">        <span class="keyword">or</span> </span><br><span class="line">        itinerary.s_time <span class="keyword">between</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 20:05:40&#x27;</span> <span class="keyword">as</span> datetime) <span class="keyword">and</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 21:25:40&#x27;</span> <span class="keyword">as</span> datetime)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> person.fullname</span><br><span class="line"><span class="comment">--7</span></span><br><span class="line"><span class="keyword">select</span> isolation_location.location_name</span><br><span class="line"><span class="keyword">from</span> isolation_location</span><br><span class="line"><span class="keyword">JOIN</span> isolation_record <span class="keyword">on</span> isolation_location.id <span class="operator">=</span> isolation_record.isol_loc_id</span><br><span class="line"><span class="keyword">WHERE</span> isolation_record.state <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> isolation_location.location_name, isolation_location.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> isolation_location.id</span><br><span class="line"></span><br><span class="line"><span class="comment">--8</span></span><br><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">30</span> person.fullname, person.telephone</span><br><span class="line"><span class="keyword">from</span> person</span><br><span class="line"><span class="keyword">where</span> person.id <span class="keyword">in</span> (<span class="keyword">SELECT</span> itinerary.p_id <span class="keyword">from</span> itinerary)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> person.id</span><br><span class="line"></span><br><span class="line"><span class="comment">--9</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> number</span><br><span class="line"><span class="keyword">from</span>(<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> person</span><br><span class="line">    <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">from</span> itinerary </span><br><span class="line">        <span class="keyword">JOIN</span> location <span class="keyword">ON</span> itinerary.loc_id <span class="operator">=</span> location.id</span><br><span class="line">        <span class="keyword">where</span> location.location_name <span class="operator">=</span> N<span class="string">&#x27;Today便利店&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> person.id <span class="operator">=</span> itinerary.p_id</span><br><span class="line">        )</span><br><span class="line">) <span class="keyword">as</span> t</span><br><span class="line">    </span><br><span class="line"><span class="comment">--10***</span></span><br><span class="line"><span class="keyword">SELECT</span> person.fullname</span><br><span class="line"><span class="keyword">from</span> person</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> location</span><br><span class="line">    <span class="keyword">WHERE</span> location.id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> itinerary.loc_id <span class="keyword">from</span> itinerary <span class="keyword">where</span> itinerary.p_id <span class="operator">=</span> person.id</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> person.fullname</span><br><span class="line"></span><br><span class="line"><span class="comment">--11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> isolation_location_status(id,location_name,capacity,occupied) <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> isolation_location.id,location_name,capacity,<span class="built_in">count</span>(isolation_record.isol_loc_id)</span><br><span class="line"><span class="keyword">from</span> isolation_location <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> isolation_record <span class="keyword">on</span> isolation_location.id<span class="operator">=</span>isolation_record.isol_loc_id <span class="keyword">and</span> state<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> isolation_location.id,location_name,capacity;</span><br><span class="line"></span><br><span class="line"><span class="comment">--12</span></span><br><span class="line"><span class="keyword">SELECT</span> location_name, capacity <span class="operator">-</span> occupied <span class="keyword">as</span> available_rooms</span><br><span class="line"><span class="keyword">from</span> isolation_location_status</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line"></span><br><span class="line"><span class="comment">--13</span></span><br><span class="line"><span class="keyword">SELECT</span> person.fullname, person.telephone</span><br><span class="line"><span class="keyword">from</span> person <span class="keyword">JOIN</span> itinerary <span class="keyword">ON</span> person.id <span class="operator">=</span> itinerary.p_id,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> itinerary <span class="keyword">WHERE</span> itinerary.p_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">from</span> person <span class="keyword">where</span> fullname <span class="operator">=</span> N<span class="string">&#x27;靳宛儿&#x27;</span>)) <span class="keyword">as</span> i</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="keyword">NOT</span>((itinerary.e_time <span class="operator">&lt;</span> i.s_time) <span class="keyword">OR</span> (itinerary.s_time <span class="operator">&gt;</span> i.e_time))) <span class="keyword">AND</span> itinerary.loc_id <span class="operator">=</span> i.loc_id  </span><br><span class="line"><span class="keyword">AND</span> person.fullname <span class="operator">!=</span> N<span class="string">&#x27;靳宛儿&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">by</span> person.fullname</span><br><span class="line"></span><br><span class="line"><span class="comment">--14</span></span><br><span class="line"><span class="keyword">SELECT</span> location.location_name, <span class="built_in">COUNT</span>(person.id) <span class="keyword">as</span> close_contact_number</span><br><span class="line"><span class="keyword">from</span> location </span><br><span class="line"><span class="keyword">join</span> close_contact <span class="keyword">on</span> location.id <span class="operator">=</span> close_contact.loc_id</span><br><span class="line"><span class="keyword">join</span> person <span class="keyword">on</span> (person.id <span class="operator">=</span> close_contact.p_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> location.location_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> close_contact_number <span class="keyword">DESC</span>, location.location_name</span><br><span class="line"></span><br><span class="line"><span class="comment">--15</span></span><br><span class="line"><span class="keyword">SELECT</span> top <span class="number">1</span> person.id <span class="keyword">as</span> case_p_id, person.fullname, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> infected_number</span><br><span class="line"><span class="keyword">from</span> person, close_contact</span><br><span class="line"><span class="keyword">where</span> person.id <span class="operator">=</span> close_contact.case_p_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> person.id, person.fullname</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> infected_number <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--16</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">3</span> person.fullname, <span class="built_in">COUNT</span>(itinerary.id) <span class="keyword">as</span> record_number</span><br><span class="line"><span class="keyword">from</span> person </span><br><span class="line"><span class="keyword">JOIN</span> itinerary <span class="keyword">on</span> person.id <span class="operator">=</span> itinerary.p_id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span>((itinerary.e_time <span class="operator">&lt;</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 10:00:00&#x27;</span> <span class="keyword">as</span> datetime)) <span class="keyword">OR</span> (itinerary.s_time <span class="operator">&gt;</span> <span class="built_in">cast</span>(<span class="string">&#x27;2021-2-2 14:00:00&#x27;</span> <span class="keyword">as</span> datetime)))</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> person.fullname</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> record_number <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--17</span></span><br><span class="line"><span class="keyword">SELECT</span> location_name, capacity</span><br><span class="line"><span class="keyword">from</span> isolation_location <span class="keyword">as</span> i1</span><br><span class="line"><span class="keyword">where</span> <span class="number">2</span> <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> i2.capacity)</span><br><span class="line">    <span class="keyword">FROM</span> isolation_location <span class="keyword">as</span> i2</span><br><span class="line">    <span class="keyword">where</span> i2.capacity <span class="operator">&gt;=</span> i1.capacity</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--4.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用create trigger语句创建符合任务要求的触发器（触发器名称自已命名）：</span></span><br><span class="line"><span class="comment">-- 当隔离表（isolation_record）中的某位隔离人员在诊断表（diagnose_record）中的</span></span><br><span class="line"><span class="comment">-- 诊断结果（result）为1(新冠确诊)时，自动将隔离表中的隔离状态（state)改成3（转入医院）。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 你需要考虑：</span></span><br><span class="line"><span class="comment">-- (1) 触发器应该建在哪个表上；</span></span><br><span class="line"><span class="comment">-- (2) 触发器执行的时机；</span></span><br><span class="line"><span class="comment">-- (3) (insert,update,delete)中的哪些(个）事件触发这个触发器运行。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> tri</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> tri <span class="keyword">ON</span> diagnose_record after <span class="keyword">insert</span>, update</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> <span class="variable">@result</span> <span class="type">int</span>, <span class="variable">@p</span>_id <span class="type">int</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="keyword">result</span>, <span class="variable">@p</span>_id <span class="operator">=</span> p_id <span class="keyword">from</span> inserted;</span><br><span class="line">        if(<span class="variable">@result</span> <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">BEGIN</span></span><br><span class="line">                UPDATE isolation_record <span class="keyword">SET</span> state <span class="operator">=</span> <span class="number">3</span> <span class="keyword">where</span> isolation_record.p_id <span class="operator">=</span> <span class="variable">@p</span>_id</span><br><span class="line">            <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri</span><br><span class="line"><span class="keyword">on</span> diagnose_record</span><br><span class="line">after update,<span class="keyword">insert</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  update isolation_record </span><br><span class="line">  <span class="keyword">set</span> state <span class="operator">=</span><span class="number">3</span></span><br><span class="line">  <span class="keyword">from</span> isolation_record</span><br><span class="line">  <span class="keyword">inner</span> <span class="keyword">join</span> diagnose_record</span><br><span class="line">  <span class="keyword">on</span> isolation_record.p_id <span class="operator">=</span> diagnose_record.p_id</span><br><span class="line">  <span class="keyword">where</span> diagnose_record.p_id <span class="keyword">in</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> p_id</span><br><span class="line">        <span class="keyword">from</span> inserted</span><br><span class="line">        <span class="keyword">where</span> <span class="keyword">result</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--4.2</span></span><br><span class="line">go</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">FUNCTION</span> Count_Records(<span class="variable">@p</span>_id <span class="type">int</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> <span class="variable">@result</span> <span class="type">int</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">from</span> itinerary <span class="keyword">where</span> itinerary.p_id <span class="operator">=</span> <span class="variable">@p</span>_id</span><br><span class="line">    <span class="keyword">RETURN</span> <span class="variable">@result</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">go</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">where</span> dbo.Count_Records(person.id) <span class="operator">&gt;</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>












            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%BB%AA%E8%AE%BA"><span class="toc-number">1.</span> <span class="toc-text">1 绪论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">概念模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#er-%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">er 模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#E-R%E5%9B%BE-entity-relationship-model"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">E-R图 entity relationship model</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">逻辑模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%BA%A7%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">三级模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.</span> <span class="toc-text">2 关系数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB"><span class="toc-number">2.1.</span> <span class="toc-text">关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="toc-number">2.1.1.</span> <span class="toc-text">关系运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%CF%83%E9%80%89%E6%8B%A9"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">σ选择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%CF%80%E6%8A%95%E5%BD%B1"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">π投影</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%CE%B8%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">θ连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%C3%B7%E9%99%A4%E6%B3%95"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">÷除法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">2.2.</span> <span class="toc-text">完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">2.2.1.</span> <span class="toc-text">实体完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">2.2.2.</span> <span class="toc-text">参照完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">2.2.3.</span> <span class="toc-text">用户定义的完整性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-sql"><span class="toc-number">3.</span> <span class="toc-text">3 sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#schema"><span class="toc-number">3.1.</span> <span class="toc-text">schema</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#table"><span class="toc-number">3.2.</span> <span class="toc-text">table</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.2.1.</span> <span class="toc-text">约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">3.2.2.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">3.2.3.</span> <span class="toc-text">修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="toc-number">3.3.</span> <span class="toc-text">数据字典</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.</span> <span class="toc-text">查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E7%90%86%E8%AE%BA"><span class="toc-number">4.</span> <span class="toc-text">6 关系数据理论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">函数依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E7%9A%84%E5%85%AC%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.2.</span> <span class="toc-text">函数依赖的公理系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%83%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">范式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1NF"><span class="toc-number">4.3.1.</span> <span class="toc-text">1NF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2NF"><span class="toc-number">4.3.2.</span> <span class="toc-text">2NF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3NF"><span class="toc-number">4.3.3.</span> <span class="toc-text">3NF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BCNF"><span class="toc-number">4.3.4.</span> <span class="toc-text">BCNF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4NF"><span class="toc-number">4.3.5.</span> <span class="toc-text">4NF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%88%86%E8%A7%A3"><span class="toc-number">4.4.</span> <span class="toc-text">模式分解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%85%B3%E7%B3%BB%E6%9F%A5%E8%AF%A2%E5%92%8C%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">9 关系查询和查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E7%AE%97%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">查询操作算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.1.2.</span> <span class="toc-text">连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D"><span class="toc-number">6.</span> <span class="toc-text">10 数据库恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.1.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D"><span class="toc-number">6.2.</span> <span class="toc-text">恢复</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">7.</span> <span class="toc-text">11 并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">7.1.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.1.1.</span> <span class="toc-text">1 级封锁协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.1.2.</span> <span class="toc-text">2 级封锁协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.1.3.</span> <span class="toc-text">3 级封锁协议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql-%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">sql 必知必会</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#primary-key"><span class="toc-number">8.1.</span> <span class="toc-text">primary key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORDER-BY"><span class="toc-number">8.2.</span> <span class="toc-text">ORDER BY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WHERE"><span class="toc-number">8.3.</span> <span class="toc-text">WHERE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE%E4%B8%8E%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">8.3.1.</span> <span class="toc-text">LIKE与通配符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5"><span class="toc-number">8.4.</span> <span class="toc-text">计算字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">8.5.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">8.5.1.</span> <span class="toc-text">聚集函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GROUP-BY"><span class="toc-number">8.6.</span> <span class="toc-text">GROUP BY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HAVING"><span class="toc-number">8.6.1.</span> <span class="toc-text">HAVING</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JOIN"><span class="toc-number">8.7.</span> <span class="toc-text">JOIN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#INNER-JOIN-ON"><span class="toc-number">8.7.1.</span> <span class="toc-text">INNER JOIN ON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OUTER-JOIN-ON"><span class="toc-number">8.7.2.</span> <span class="toc-text">OUTER JOIN ON</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">9.</span> <span class="toc-text">实验</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
