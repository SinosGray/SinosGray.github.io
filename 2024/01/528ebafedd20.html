<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Category: 读书笔记 | Sinos_wei's blog</title><meta name="author" content="Sinos"><meta name="copyright" content="Sinos"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta property="og:type" content="article">
<meta property="og:title" content="rfc笔记">
<meta property="og:url" content="https://sinos_wei.gitee.io/2024/01/528ebafedd20.html">
<meta property="og:site_name" content="Sinos_wei&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sinos_wei.gitee.io/img/cover/20220911203537_1.JPG">
<meta property="article:published_time" content="2024-01-23T07:04:16.000Z">
<meta property="article:modified_time" content="2024-01-23T13:14:47.106Z">
<meta property="article:author" content="Sinos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sinos_wei.gitee.io/img/cover/20220911203537_1.JPG"><link rel="shortcut icon" href="/img/avatar.jpeg"><link rel="canonical" href="https://sinos_wei.gitee.io/2024/01/528ebafedd20.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?aeddd8219bc5c1e1efdcf5d9cc3218e6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Category: 读书笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-23 21:14:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">207</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/20220911203537_1.JPG')"><nav id="nav"><span id="blog-info"><a href="/" title="Sinos_wei's blog"><span class="site-name">Sinos_wei's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">rfc笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">Updated</span><time datetime="2024-01-23T13:14:47.106Z" title="Updated 2024-01-23 21:14:47">2024-01-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="rfc笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>

</blockquote>
<span id="more"></span>
<h1 id="tcpip-tutorial"><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc1180.txt">tcp/ip tutorial</a></h1>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> ----------------------------</span><br><span class="line"> |    network applications  |</span><br><span class="line"> |                          |</span><br><span class="line"> |...  \ | /  ..  \ | /  ...|</span><br><span class="line"> |     -----      -----     |</span><br><span class="line"> |     |TCP|      |UDP|     |</span><br><span class="line"> |     -----      -----     |</span><br><span class="line"> |         \      /         |</span><br><span class="line"> |         --------         |</span><br><span class="line"> |         |  IP  |         |</span><br><span class="line"> |  -----  -*------         |</span><br><span class="line"> |  |ARP|   |               |</span><br><span class="line"> |  -----   |               |</span><br><span class="line"> |      \   |               |</span><br><span class="line"> |      ------              |</span><br><span class="line"> |      |ENET|              |</span><br><span class="line"> |      ---@--              |</span><br><span class="line"> ----------|-----------------</span><br><span class="line">           |</span><br><span class="line">-----------o--------------------</span><br><span class="line">Ethernet Cable</span><br><span class="line">框（boxes）：表示数据经过计算机时，在这些地方处理数据</span><br><span class="line">框之间的连线（lines）：表示数据的流经路径</span><br><span class="line">最下面的横线：表示一根以太网网线（Ethernet cable）</span><br><span class="line">o 符号：收发器（transceiver）</span><br><span class="line">* 符号：IP 地址</span><br><span class="line">@ 符号：以太网地址</span><br></pre></td></tr></table></figure>
<p>In summary: if it is on an Ethernet it is called an Ethernet frame; if it is between the Ethernet driver and the IP module it is called a IP packet; if it is between the IP module and the UDP module it is called a UDP datagram; if it is between the IP module and the TCP module it is called a TCP segment (more generally, a transport message); and if it is in a network application it is called a application message. <strong>more RFC 1122</strong></p>
<p>不同以太网的两个机器A, B通过路由器 R 间接转发</p>
<ul>
<li>源 IP 和源以太网地址是 A 的。</li>
<li><strong>目的 IP 地址是 B 的 IP 地址</strong>。</li>
<li><strong>目的以太网地址是 R 的以太网地址</strong>：因为 A 的 IP 模块需要将这个 IP 包发送给 R 做转发。</li>
</ul>
<p>hosts 文件相当于计算机本地的 dns 服务器</p>
<p>每个计算机都有自己的路由表 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--------------------------------------------------------------------</span><br><span class="line">|network      direct/indirect flag  router         interface number|</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">|223.1.2      direct                &lt;blank&gt;        1               |</span><br><span class="line">|223.1.3      indirect              223.1.2.4      1               |</span><br><span class="line">|223.1.4      indirect              223.1.2.4      1               |</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">             TABLE 11.  Alpha Route Table with Numbers</span><br></pre></td></tr></table></figure></p>
<p>UDP <strong>保留了应用定义的消息边界</strong>（message boundary defined by the application） 。它不会将应用的两条消息合并，或者将一条消息做拆分。 TCP 提供了<strong>面向连接的字节流</strong>（ connection-oriented byte stream），而非无连接的数据报传送服务</p>
<h1 id="证书与公钥基础设施"><a target="_blank" rel="noopener" href="https://arthurchiao.art/blog/everything-about-pki-zh/">证书与公钥基础设施</a></h1>
<h1 id="tcp-793-tcp-9293"><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc793">TCP 793</a> <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc9293.html">TCP 9293</a></h1>
<p>翻译: https://blog.csdn.net/aigoogle/article/details/121036557</p>
<h2 id="基本数据操作">基本数据操作</h2>
<p>可以把数据看做是连接上的字节流。发送方通过SEND指令发送数据，如果发送的数据中指定了PUSH标志，数据会立即从发送方的缓存中发送出去。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          Source Port          |       Destination Port        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                        Sequence Number                        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Acknowledgment Number                      |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|  Data |       |C|E|U|A|P|R|S|F|                               |</span><br><span class="line">| Offset| Rsrvd |W|C|R|C|S|S|Y|I|            Window             |</span><br><span class="line">|       |       |R|E|G|K|H|T|N|N|                               |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|           Checksum            |         Urgent Pointer        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                           [Options]                           |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                                                               :</span><br><span class="line">:                             Data                              :</span><br><span class="line">:                                                               |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>校验和: 参与的部分: 伪首部, tcp首部, tcp数据 对IP头部中的每16bit进行二进制求和, 校验和在计算时, 校验和字段视为全 0 伪首部: 伪首部共有12字节: 源IP地址、目的IP地址、保留字节(置0)、传输层协议号(TCP是6)、TCP报文长度(报头+数据)。</p>
<p>每一个字节对应一个序列号</p>
<p>重传队列里是 tcp 包而不是字节流</p>
<p>维护 tcp 连接状态的变量: TCP 控制块(TCB)</p>
<ul>
<li><p>发送序列变量 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SND.UNA - 发送但未确认的</span><br><span class="line">SND.NXT - 下次发送的字节序列号</span><br><span class="line">SND.WND - 发送窗口</span><br><span class="line">SND.UP  - 紧急数据指针</span><br><span class="line">SND.WL1 - 上次更新窗口使用的字节序列号</span><br><span class="line">SND.WL2 - 上次更新窗口使用的确认序列号</span><br><span class="line">ISS     - 初始序列号</span><br><span class="line"></span><br><span class="line">     1         2          3          4</span><br><span class="line">----------|----------|----------|----------</span><br><span class="line">       SND.UNA    SND.NXT    SND.UNA</span><br><span class="line">                            +SND.WND</span><br><span class="line">1 - 已经被确认的字节序列</span><br><span class="line">2 - 未确认的字节序列</span><br><span class="line">3 - 新数据发送可以使用的字节序列</span><br><span class="line">4 - 还没有分配的，未来会用的字节序列号</span><br></pre></td></tr></table></figure></p></li>
<li><p>接受序列变量 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RCV.NXT - 下次希望接收的字节序列号</span><br><span class="line">RCV.WND - 接收窗口大小</span><br><span class="line">RCV.UP  - 紧急数据指针</span><br><span class="line">IRS     - 连接建立时初始序列号</span><br><span class="line"></span><br><span class="line">   1          2          3</span><br><span class="line">----------|----------|----------</span><br><span class="line">      RCV.NXT    RCV.NXT</span><br><span class="line">                +RCV.WND</span><br><span class="line">1 - 被确认的序列号</span><br><span class="line">2 - 打算接收的序列号</span><br><span class="line">3 - 还未被分配的序列号</span><br></pre></td></tr></table></figure></p></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                            +---------+ ---------\      active OPEN</span><br><span class="line">                     start  |  CLOSED |            \    -----------</span><br><span class="line">                            +---------+&lt;---------\   \   create TCB</span><br><span class="line">                              |     ^              \   \  snd SYN</span><br><span class="line">                 passive OPEN |     |   CLOSE        \   \</span><br><span class="line">                 ------------ |     | ----------       \   \</span><br><span class="line">                  create TCB  |     | delete TCB         \   \</span><br><span class="line">                              V     |                      \   \</span><br><span class="line">                            +---------+            CLOSE    |    \</span><br><span class="line">                            |  LISTEN |          ---------- |     |</span><br><span class="line">                            +---------+          delete TCB |     |</span><br><span class="line">                 rcv SYN      |     |     SEND              |     |</span><br><span class="line">                -----------   |     |    -------            |     V</span><br><span class="line">+---------+      snd SYN,ACK  /       \   snd SYN          +---------+</span><br><span class="line">|         |&lt;-----------------           ------------------&gt;|         |</span><br><span class="line">|   SYN   |                    rcv SYN                     |   SYN   |</span><br><span class="line">|   RCVD  |&lt;-----------------------------------------------|   SENT  |</span><br><span class="line">|         |                    snd ACK                     |         |</span><br><span class="line">|         |------------------           -------------------|         |</span><br><span class="line">+---------+   rcv ACK of SYN  \       /  rcv SYN,ACK       +---------+</span><br><span class="line"> |           --------------   |     |   -----------</span><br><span class="line"> |                  x         |     |     snd ACK</span><br><span class="line"> |                            V     V</span><br><span class="line"> |  CLOSE                   +---------+</span><br><span class="line"> | -------                  |  ESTAB  |</span><br><span class="line"> | snd FIN                  +---------+</span><br><span class="line"> |                   CLOSE    |     |    rcv FIN</span><br><span class="line"> V                  -------   |     |    -------</span><br><span class="line">+---------+          snd FIN  /       \   snd ACK          +---------+</span><br><span class="line">|  FIN    |&lt;-----------------           ------------------&gt;|  CLOSE  |</span><br><span class="line">| WAIT-1  |------------------                              |   WAIT  |</span><br><span class="line">+---------+          rcv FIN  \                            +---------+</span><br><span class="line"> | rcv ACK of FIN   -------   |                            CLOSE  |</span><br><span class="line"> | --------------   snd ACK   |                           ------- |</span><br><span class="line"> V        x                   V                           snd FIN V</span><br><span class="line">+---------+                  +---------+                   +---------+</span><br><span class="line">|FINWAIT-2|                  | CLOSING |                   | LAST-ACK|</span><br><span class="line">+---------+                  +---------+                   +---------+</span><br><span class="line"> |                rcv ACK of FIN |                 rcv ACK of FIN |</span><br><span class="line"> |  rcv FIN       -------------- |    Timeout=2MSL -------------- |</span><br><span class="line"> |  -------              x       V    ------------        x       V</span><br><span class="line">  \ snd ACK                 +---------+delete TCB         +---------+</span><br><span class="line">   ------------------------&gt;|TIME WAIT|------------------&gt;| CLOSED  |</span><br><span class="line">                            +---------+                   +---------+</span><br><span class="line"></span><br><span class="line">                    TCP Connection State Diagram</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://raw.githubusercontent.com/SinosGray/picgo/master/test/202401231944627.jpeg" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>closed 状态不存在 TCB</p>
<p>需要注意的是，当接收窗口大小为0时，除了ack数据段以外其他数据段都不会被接收。所以，TCP可以在窗口为0的情况下继续发送数据和接收确认。然而，即使接收窗口为0，TCP也必须接收带有RST和URG标识的数据段。</p>
<p><strong>ISN</strong> 为了避免冲突，当之前连接实体发送的数据段还在网络上传输时，新的连接实体应该避免使用相同的序列号。当一个新的连接实体建立时，一个初始序列号（ISN）选择器会用来选择一个新的32的初始编号。选择器使用一个32位的时钟（有可能是虚拟的），这个时钟的低位会以4微秒一个的速度增长。所以ISN会大概4.5个小时循环一次。因为我们假定一个数据段在网络中最多存留一个MSL（最大段生命周期）时间段，并且MSG比4.5个小时短很多，所以我们判断，ISN是唯一的。(对于流量特别大的网络可以增加 timestamp 选项继续预防) ISN = M + F(localip, localport, remoteip, remoteport, secretkey) 加密是为了防止有人猜出 ISN 冒充通信</p>
<p><strong>三次握手步骤是必须的</strong>(四次握手的中间两次合并成一次)，接收方收到第一个SYN的时候没有办法确定这个SYN是否是之前连接实例发送的老旧的SYN数据包除非接收方一直保存之前连接使用的最后一个序列号，所以一般接收方需要发送方来检验这个SYN（通过向发送方返回ACK信息）。</p>
<p><strong>TCP静默时间概念</strong> 如果在一个主机组成的计算机网络系统中主机突然宕机了并且没有保存所有处于活跃状态（Closed以外的其他状态）的连接的相关状态信息的情况下，主机重启后需要等待约定的一段时间（1 MSL）才能开始重新建立连接。 这个链接实例发送的数据序列号, 有可能与之前连接实例发送的, 并且在网络中传输中的数据序列号相等或者有重叠。在不了解一个指定的连接之前的序号的情况下，TCP规范规定TCP发送模块应该等待一个MSL时间，来让之前连接实例发送的数据段从网络上排空。</p>
<p>如果没有静默时间</p>
<ol type="1">
<li>重启后新的链接可能收到上次链接的数据包</li>
<li>新的数据可能被当做重复数据丢掉(上次链接的数据顶掉了新数据?)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    TCP A                                           TCP B</span><br><span class="line">1.  (CRASH)                               (send 300,receive 100)</span><br><span class="line">2.  CLOSED                                           ESTABLISHED</span><br><span class="line">3.  SYN-SENT --&gt; &lt;SEQ=400&gt;&lt;CTL=SYN&gt;              --&gt; (??)</span><br><span class="line">4.  (!!)     &lt;-- &lt;SEQ=300&gt;&lt;ACK=100&gt;&lt;CTL=ACK&gt;     &lt;-- ESTABLISHED</span><br><span class="line">rst 重置连接</span><br><span class="line">5.  SYN-SENT --&gt; &lt;SEQ=100&gt;&lt;CTL=RST&gt;              --&gt; (Abort!!)</span><br><span class="line">6.  SYN-SENT                                         CLOSED</span><br><span class="line">7.  SYN-SENT --&gt; &lt;SEQ=400&gt;&lt;CTL=SYN&gt;              --&gt; </span><br><span class="line"></span><br><span class="line">                   Half-Open Connection Discovery</span><br></pre></td></tr></table></figure>
<p>通常情况下如果收到一个不属于本连接实例的数据段的话都要产生并发送重置控制包。如果不确定这个包是不是这个连接的，不能发送重置控制包。</p>
<ol type="1">
<li>当连接不存在时除了reset控制包之外的其他数据包发送过来时，都应该向对端发送一个重置控制包。</li>
<li>如果连接处于非同步状态（LISTEN,SYN-SENT,SYN-RECEIVED）收到了未曾发送过的数据段的确认信息或者收到的数据段的安全等级、隔离级别与当前连接要求的不符合，接收端将会向发送端发送一个重置消息。</li>
</ol>
<p>即使发送窗口为0，TCP发送模块在收到用户传过来的数据后，也要发送最少一个字节。 即使接收窗口为0，发送方也要定时发送数据到接收方, 接收方也要处理 URG 和 RST 报文。 当接收窗口为0时，发送方的数据重试间隔为2分钟。当任一个TCP接收窗口为0时，定时发送数据会把接收方重新打开的窗口通知到发送方，这样是很有必要的。</p>
<h2 id="可靠性">可靠性</h2>
<p>序号, ack, 数据段的校验和</p>
<h2 id="流量控制">流量控制</h2>
<p>接收方控制发送方发送的数据量, 接收方在每次发送确认信息（ACK）的时候携带一个win参数来通知发送方剩余的可发送字节数。</p>
<h2 id="多路复用">多路复用</h2>
<p>端口</p>
<h2 id="连接">连接</h2>
<p>握手</p>
<h2 id="安全">安全</h2>
<h4 id="读至-3.4.2.knowing-when-to-keep-quiet">读至 <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc9293.html#section-3.4.2">3.4.2.</a><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc9293.html#name-knowing-when-to-keep-quiet">Knowing When to Keep Quiet</a></h4>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://sinos_wei.gitee.io">Sinos</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://sinos_wei.gitee.io/2024/01/528ebafedd20.html">https://sinos_wei.gitee.io/2024/01/528ebafedd20.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/cover/20220911203537_1.JPG" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/01/e6a15612f4ba.html" title="react"><img class="cover" src="/img/cover/00000093.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">react</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Sinos</div><div class="author-info__description">己所不欲, 勿施于人</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">207</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/SinosGray"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SinosGray" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1143474942@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://8.130.42.149:5230" target="_blank" title="memo"><i class="fab fa-heart"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tcpip-tutorial"><span class="toc-number">1.</span> <span class="toc-text">tcp&#x2F;ip tutorial</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E4%B8%8E%E5%85%AC%E9%92%A5%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"><span class="toc-number">2.</span> <span class="toc-text">证书与公钥基础设施</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp-793-tcp-9293"><span class="toc-number">3.</span> <span class="toc-text">TCP 793 TCP 9293</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">3.1.</span> <span class="toc-text">基本数据操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">3.2.</span> <span class="toc-text">可靠性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">3.3.</span> <span class="toc-text">流量控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-number">3.4.</span> <span class="toc-text">多路复用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.5.</span> <span class="toc-text">连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">3.6.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E8%87%B3-3.4.2.knowing-when-to-keep-quiet"><span class="toc-number">3.6.0.1.</span> <span class="toc-text">读至 3.4.2.Knowing When to Keep Quiet</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/a6f2ba33bf73.html" title="ts js html"><img src="/img/cover/00000197.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ts js html"/></a><div class="content"><a class="title" href="/2023/07/a6f2ba33bf73.html" title="ts js html">ts js html</a><time datetime="2024-01-28T12:41:26.652Z" title="Updated 2024-01-28 20:41:26">2024-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/e6a15612f4ba.html" title="react"><img src="/img/cover/00000093.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="react"/></a><div class="content"><a class="title" href="/2024/01/e6a15612f4ba.html" title="react">react</a><time datetime="2024-01-24T02:56:27.097Z" title="Updated 2024-01-24 10:56:27">2024-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/528ebafedd20.html" title="rfc笔记"><img src="/img/cover/20220911203537_1.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rfc笔记"/></a><div class="content"><a class="title" href="/2024/01/528ebafedd20.html" title="rfc笔记">rfc笔记</a><time datetime="2024-01-23T13:14:47.106Z" title="Updated 2024-01-23 21:14:47">2024-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/149566d76407.html" title="为什么这么设计"><img src="/img/cover/00000071.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="为什么这么设计"/></a><div class="content"><a class="title" href="/2023/12/149566d76407.html" title="为什么这么设计">为什么这么设计</a><time datetime="2024-01-23T12:24:26.502Z" title="Updated 2024-01-23 20:24:26">2024-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/09/4df836237f4a.html" title="计算机网络总结"><img src="/img/cover/00000051.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络总结"/></a><div class="content"><a class="title" href="/2020/09/4df836237f4a.html" title="计算机网络总结">计算机网络总结</a><time datetime="2024-01-11T12:29:15.372Z" title="Updated 2024-01-11 20:29:15">2024-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Sinos</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>